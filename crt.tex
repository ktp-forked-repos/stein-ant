\chapter{The Chinese Remainder Theorem}\label{ch:crt}
We prove the Chinese Remainder Theorem (CRT) for commutative rings and
discuss how to compute with it.  We also apply the Chinese Remainder
Theorem to prove that every ideal in $\O_K$ is generated by two
elements and determine the structure of $\p^n/\p^{n+1}$, where $\p$ is
a nonzero prime ideal of $\O_K$.

%The
%technical tools we develop in this chapter will be used repeatedly
%in the proofs of other results later.

\section{The Chinese Remainder Theorem}

\subsection{CRT in the Integers}
The Chinese Remainder Theorem from elementary number
theory asserts that if $n_1,\ldots, n_r$ are integers that are coprime
in pairs, and $a_1,\ldots, a_r$ are integers, then there exists an
integer~$a$ such that $a\con a_i\pmod{n_i}$ for each $i=1,\ldots,r$.
Here ``coprime in pairs'' means that $\gcd(n_i,n_j)=1$ whenever
$i\neq j$; it does {\em not} mean that $\gcd(n_1,\ldots, n_r)=1$,
though it implies this. 
In terms of rings, the Chinese Remainder Theorem (CRT) asserts that the
natural map
\begin{equation}\label{eqn:crt}
\Z/(n_1\cdots n_r)\Z \to (\Z/n_1\Z)\oplus \cdots \oplus (\Z/n_r\Z)
\end{equation}
that sends $a \in \Z$ to its reduction modulo each $n_i$,
is an isomorphism.  

This map is {\em not} an isomorphism if the $n_i$ are not coprime.
Indeed, the cardinality of the image of the left hand side of
(\ref{eqn:crt}) is $\lcm(n_1,\ldots, n_r)$, since it is the image of a
cyclic group and $\lcm(n_1,\ldots, n_r)$ is the largest order of an
element of the right hand side, whereas the cardinality of the right
hand side is $n_1\cdots n_r$.

The isomorphism (\ref{eqn:crt}) can alternatively be viewed as
asserting that any system of linear congruences
$$
  x \con a_1 \pmod{n_1}, \quad  
x \con a_2 \pmod{n_2}, \quad
\cdots, 
x \con a_r \pmod{n_r}
$$
with pairwise coprime moduli has a unique solution modulo $n_1\ldots n_r$.

Before proving the CRT in more generalize, we prove
(\ref{eqn:crt}).
There is a natural map 
$$
  \phi: \Z \to (\Z/n_1\Z)\oplus \cdots \oplus (\Z/n_r\Z)
$$
given by projection onto each factor.  It's kernel is
$$
 n_1 \Z \cap \cdots \cap n_r \Z.
$$ 
If $n$ and $m$ are integers, then $n\Z\cap m\Z$ is the
set of multiples of both $n$ and $m$, so $n\Z\cap m\Z = \lcm(n,m)\Z$.
Since the $n_i$ are coprime, 
$$
 n_1 \Z \cap \cdots \cap n_r \Z = n_1 \ldots n_r \Z.
$$ 
Thus we have proved there is an inclusion 
\begin{equation}\label{eqn:crt_inj}
 i: \Z/(n_1\cdots n_r)\Z \hra (\Z/n_1\Z)\oplus \cdots \oplus (\Z/n_r\Z).
\end{equation}
This is half of the CRT; the other half is to prove that this map is
surjective.  In this case, it is clear that $i$ is also surjective,
because $i$ is an injective map between sets of the same cardinality.
We will, however, give a proof of surjectivity that doesn't use
finiteness of the above two sets.

To prove surjectivity of $i$, note that since the $n_i$ are coprime in
pairs, $$\gcd(n_1, n_2\ldots n_r)=1,$$ so there exists integers $x,y$
such that
$$
   x n_1 + y n_2\cdots n_r = 1.
$$
To complete the proof, observe that 
$ y n_2\cdots n_r = 1 - x n_1$
is congruent to~$1$ modulo $n_1$ and~$0$ modulo $n_2\cdots n_r$.
Thus $(1,0,\ldots,0) = i (y n_2\cdots n_r)$ is in the image of~$i$.  
By a similar argument, we see that $(0,1,\ldots,0)$ and the
other similar elements are all in the image of~$i$, so $i$
is surjective, which proves CRT.  

\subsection{CRT in General}
Recall that {\em all rings in this book are commutative with unity}.
\begin{definition}[Coprime]
Ideals $I$ and $J$ are \defn{coprime} if $I+J=(1)$.
\end{definition}
If~$I$ and~$J$ are nonzero ideals in the ring of integers of a number
field, then they are coprime precisely when the prime ideals that
appear in their two (unique) factorizations are disjoint.

\begin{lemma}\label{lem:prodint}\ilem{$I\cap{}J = IJ$}
If $I$ and $J$ are coprime ideals in a ring $R$, then
$I\cap{}J = IJ$.
\end{lemma}
\begin{proof}
Choose $x\in I$ and $y\in J$
such that $x+y=1$.  If $c\in{} I\cap{} J$ then 
$$c=c\cdot 1=c\cdot (x+y) = cx + cy \in IJ + IJ = IJ,$$
so $I\cap{} J\subset IJ$.  
The other inclusion is obvious by definition of ideal.
\end{proof}

\begin{lemma}\label{lem:coprime_prod}
Suppose $I_1,\ldots, I_s$ are pairwise coprime ideals.
Then $I_1$ is coprime to the product $I_2\cdots I_s$.
\end{lemma}
\begin{proof}
It suffices to prove the lemma in the case $s=3$, since the
general case then follows from induction.
By assumption, there
are $x_1 \in I_1, y_2 \in I_2$ and $a_1 \in I_1, b_3 \in I_3$
such
$$ 
x_1 + y_2 = 1 \qquad\text{and}\qquad a_1 + b_3 = 1.
$$
Multiplying these two relations yields
$$
x_1 a_1 + x_1 b_3 + y_2 a_1 + y_2 b_3 = 1 \cdot 1 = 1.
$$
The first three terms are in $I_1$ and the last term is in 
$I_2 I_3 = I_2 \cap I_3$ (by Lemma~\ref{lem:prodint}), 
so $I_1$ is coprime to $I_2 I_3$.
\end{proof}

Next we prove the general Chinese Remainder Theorem.
We will apply this result with $R=\O_K$ in the rest of this chapter.
\begin{theorem}[Chinese Remainder Theorem]\label{thm:crt}
\ithm{chinese remainder}
Suppose $I_1,\ldots, I_r$ are nonzero ideals of a ring~$R$ such 
$I_m$ and $I_n$ are coprime for any $m\neq n$.  Then the natural
homomorphism $R \to \bigoplus_{n=1}^r R/I_n$ induces an isomorphism
$$
\psi: R/\prod_{n=1}^r I_n \to \bigoplus_{n=1}^r R/I_n.
$$
Thus given any $a_n \in R$, for $n=1,\ldots,r$, there exists some $a\in R$
such that $a\con a_n\pmod{I_n}$ for $n=1,\ldots, r$; moreover,~$a$ 
is unique modulo $\prod_{n=1}^r I_n$.
\end{theorem}

\begin{proof}
Let 
$
  \vphi:R \to \bigoplus_{n=1}^r R/I_n
$
be the natural map induced by reduction modulo
the $I_n$.  
An inductive application of Lemma~\ref{lem:prodint} 
implies that
the kernel $\cap_{n=1}^r I_n$ of~$\vphi$ 
is equal to 
$\prod_{n=1}^r I_n$, so the map~$\psi$ of the theorem is injective.  

Each projection $R\to R/I_n$ is  surjective, so to prove
that $\psi$ is surjective, it suffices 
to show that $(1,0,\ldots,0)$
is in the image of~$\vphi$, and similarly for the other
factors.  By Lemma~\ref{lem:coprime_prod}, 
$J=\prod_{n=2}^rI_n$ is coprime to~$I_1$, so
there exists $x\in I_1$ and $y \in J$ such that
$x+y=1$.  Then $y = 1-x$ maps to~$1$ in 
$R/I_1$ and to~$0$ in $R/J$, hence to~$0$ in $R/I_n$
for each $n\geq 2$, since $J\subset I_n$. 
\end{proof}

\section{Structural Applications of the CRT}
The next lemma is an application of the Chinese Remainder
Theorem.  We will use it to prove that every ideal of $\O_K$ can be
generated by two elements. Suppose that~$I$ is a nonzero integral ideals of
$\O_K$.  If $a\in I$, then $(a)\subset I$, so~$I$ divides~$(a)$ and
the quotient $(a)I^{-1}$ is an integral ideal.  The following lemma
asserts that~$(a)$ can be chosen so the quotient $(a)I^{-1}$ is coprime to
any given ideal.
\begin{lemma}\label{lem:magica}
If $I$ and $J$ are nonzero integral ideals in $\O_K$, then there exists
an $a\in I$ such that the integral ideal $(a)I^{-1}$ is coprime to~$J$.
\end{lemma}
Before we give the proof in general, note that the lemma is trivial
when $I$ is principal, since if $I=(b)$, just take $a=b$, and 
then $(a)I^{-1} = (a)(a^{-1})= (1)$ is coprime to every ideal.
\begin{proof}
Let $\p_1,\ldots, \p_r$ be the prime divisors of~$J$.
For each $n$, let $v_n$ be the largest power of $\p_n$
that divides~$I$.  
Since $\p_n^{v_n}\neq \p_n^{v_n+1}$, 
we can choose an element $a_n\in \p_n^{v_n}$
that is not in $\p_n^{v_n+1}$.
By Theorem~\ref{thm:crt} applied to
the $r+1$ coprime integral ideals
$$
  \p_1^{v_1+1}, \ldots, \p_r^{v_r+1}, \, I\cdot \left(\prod \p_n^{v_n}\right)^{-1},
$$
there exists $a\in \O_K$
such that
$$
   a \con a_n \pmod{\p_n^{v_n+1}}
$$
for all $n=1,\ldots, r$ and
also 
$$
   a \con 0 \quad \left(\text{mod}\,\,\, I\cdot \left(\prod \p_n^{v_n}\right)^{-1}\right).
$$

To complete the proof we show that $(a)I^{-1}$ is not
divisible by any $\p_n$, or equivalently, that each 
$\p_n^{v_n}$ exactly divides $(a)$. 
First we show that $\p_n^{v_n}$ divides $(a)$. Because
$a\con a_n \pmod{\p_n^{v_n+1}}$, there exists 
$b \in \p_n^{v_n+1}$ such that $a = a_n + b$.  Since
$a_n\in \p_n^{v_n}$ and $b \in \p_n^{v_n + 1} \subset \p_n^{v_n}$, 
it follows that $a\in \p_n^{v_n}$,
so $\p_n^{v_n}$ divides~$(a)$.  
Now assume for the sake of contradiction that
$\p_n^{v_n+1}$ divides $(a$); then $a_n=a-b\in \p_n^{v_n+1}$, which
contradicts that we chose $a_n \not\in\p_n^{v_n+1}$.
Thus
$\p_n^{v_n+1}$ does not divide $(a)$, as claimed. 
\end{proof}

Suppose~$I$ is a nonzero ideal of $\O_K$.  As an abelian group $\O_K$
is free of rank equal to the degree $[K:\Q]$ of $K$, and~$I$ is of
finite index in $\O_K$, so~$I$ can be generated as an abelian group,
hence as an ideal, by $[K:\Q]$ generators.  The following proposition
asserts something much better, namely that~$I$ can be generated {\em
as an ideal} in $\O_K$ by at most two elements.
\begin{proposition}\iprop{ideals generated by two elements}\label{prop:2gen}
Suppose $I$ is a fractional ideal in the ring $\O_K$ of integers of a
number field.  Then there exist $a,b\in{}K$ such that 
$I=(a,b)=\{\alpha a + \beta b : \alpha,\beta \in \O_K\}$.
\end{proposition}
\begin{proof}
If $I=(0)$, then $I$ is generated by $1$ element and we are done.  If
$I$ is not an integral ideal, then there is $x\in K$ such that $xI$ is
an integral ideal, and the number of generators of $xI$ is the same as
the number of generators of $I$, so we may assume that $I$ is an
integral ideal.  

Let $a$ be {\em any} nonzero element of the integral ideal~$I$.  We
will show that there is some $b\in I$ such that $I=(a,b)$.  Let
$J=(a)$.  By Lemma~\ref{lem:magica}, there exists $b\in I$ such that
$(b)I^{-1}$ is coprime to $(a)$.  Since $a,b\in I$, we have $I\mid
(a)$ and $I\mid (b)$, so $I\mid (a,b)$.  Suppose $\p^n\mid (a,b)$ with
$\p$ prime and $n\geq 1$.  Then $\p^n\mid (a)$ and $\p^n\mid (b)$, so
$\p\nmid (b)I^{-1}$, since $(b)I^{-1}$ is coprime to $(a)$.  We have
$\p^n\mid(b) = I\cdot (b)I^{-1}$ and $\p\nmid (b)I^{-1}$, so $\p^n
\mid I$.  Thus by unique factorization of ideals in $\O_K$ we
have that $(a,b)\mid I$.  Sine $I \mid (a,b)$ we conclude
that  $I=(a,b)$, as claimed.
\end{proof}

We can also use Theorem~\ref{thm:crt} to determine the
$\O_K$-module structure of $\p^n/\p^{n+1}$.
\begin{proposition}\label{prop:quopow}\iprop{structure of $\p^n/\p^{n+1}$}
Let $\p$ be a nonzero prime ideal of $\O_K$, and let $n\geq 0$ be an
integer.  Then $\p^n/\p^{n+1} \isom \O_K/\p$ as $\O_K$-modules.
\end{proposition}
\begin{proof}\footnote{Proof from \cite[pg.~13]{sd:brief}.}
Since $\p^n\neq \p^{n+1}$, by unique factorization, 
there is an element $b\in
\p^n$ such that $b\not\in \p^{n+1}$.  Let
$\vphi:\O_K\to\p^n/\p^{n+1}$ be the $\O_K$-module morphism defined by
$\vphi(a)=ab$.  The kernel of $\vphi$ is $\p$ since clearly
$\vphi(\p)=0$ and if $\vphi(a)=0$ then $ab\in\p^{n+1}$, so
$\p^{n+1}\mid (a)(b)$, so $\p\mid (a)$, since $\p^{n+1}$ does not
divide~$(b)$.  Thus~$\vphi$ induces an injective $\O_K$-module
homomorphism $\O_K/\p\hra \p^{n}/\p^{n+1}$.

It remains to show that $\vphi$ is surjective, and this is where we
will use Theorem~\ref{thm:crt}.   Suppose $c\in \p^{n}$.
By Theorem~\ref{thm:crt} there exists $d\in \O_K$
such that
$$
  d \con c\pmod{\p^{n+1}}
\qquad\text{and}\qquad
  d \con 0\pmod{(b)/\p^{n}}.
$$
We have $\p^n\mid (d)$ since $d\in\p^n$ and $(b)/\p^n\mid (d)$
by the second displayed condition, so 
since $\p\nmid(b)/\p^n$, we have $(b)=\p^n\cdot(b)/\p^n\mid (d)$, hence 
$d/b\in \O_K$.   Finally
\[
 \vphi\left(\frac{d}{b}\right) \quad =\quad \frac{d}{b}\cdot d \pmod{\p^{n+1}} 
 \quad=\quad b\pmod{p^{n+1}} \quad=\quad c\pmod{p^{n+1}},
\]
so $\vphi$ is surjective.
\end{proof}

\section{Computing Using the CRT}
In order to explicitly compute an $a$ as given by the Theorem~\ref{thm:crt},
usually one first precomputes elements $v_1, \ldots, v_r \in R$ such that
$v_1\mapsto (1,0,\ldots, 0)$, 
$v_2\mapsto (0,1,\ldots, 0)$, etc.
Then given any $a_n \in R$, for $n=1,\ldots, r$, we obtain an $a \in R$
with $a_n\con a\pmod{I_n}$ by taking
$$
  a = a_1 v_1 + \cdots + a_r v_r.
$$
How to compute the $v_i$ depends on the ring~$R$.   It reduces to
the following problem: Given coprimes ideals $I,J\subset R$, find
$x\in I$ and $y\in J$ such that $x+y=1$.   If $R$ is torsion free and
of finite rank 
as a $\Z$-module, so $R\ncisom \Z^n$,
then $I, J$ can be represented by giving a basis in terms of a basis
for~$R$, and finding $x,y$ such  that $x+y=1$ can then be reduced to 
a problem in linear algebra over~$\Z$.  
More precisely, let~$A$
be the matrix whose columns are the concatenation of a basis for~$I$
with a basis for~$J$.  
Suppose $v\in \Z^n$ corresponds to $1\in\Z^n$.
Then finding $x,y$ such that $x+y=1$ is equivalent to
finding a solution $z\in \Z^n$ to the matrix equation
$Az = v$. This latter linear algebra problem
can be solved using Hermite normal form 
(see \cite[\S4.7.1]{cohen:course_ant}),
which is a generalization over $\ZZ$
of reduced row echelon form.

%We next describe how to use \magma{} and PARI to do CRT computations.

[[rewrite this to use Sage.]]

\subsection{\magma{}}
The \magma{} command {\tt ChineseRemainderTheorem} implements the
algorithm suggested by Theorem~\ref{thm:crt}.  In the following example,
we compute a prime over~$(3)$ and a prime over~$(5)$ of the ring of
integers of $\Q(\sqrt[3]{2})$, and find an element of $\O_K$ that is
congruent to $\sqrt[3]{2}$ modulo one prime and~$1$ modulo the other.
\begin{verbatim}
   > R<x> := PolynomialRing(RationalField());
   > K<a> := NumberField(x^3-2);
   > OK := RingOfIntegers(K);
   > I := Factorization(3*OK)[1][1];
   > J := Factorization(5*OK)[1][1];
   > I;
   Prime Ideal of OK
   Two element generators:
       [3, 0, 0]
       [4, 1, 0]
   > J;
   Prime Ideal of OK
   Two element generators:
       [5, 0, 0]
       [7, 1, 0]
   > b := ChineseRemainderTheorem(I, J, OK!a, OK!1);
   > K!b;
   -4
   > b - a in I;
   true
   > b - 1 in J;
   true
\end{verbatim}

\subsection{PARI}
There is also a CRT algorithm for number fields in PARI, but it
is more cumbersome to use.  First we defined $\Q(\sqrt[3]{2})$
and factor the ideals $(3)$ and $(5)$.
\begin{verbatim}
   ? f = x^3 - 2;
   ? k = nfinit(f);
   ? i = idealfactor(k,3);
   ? j = idealfactor(k,5);
\end{verbatim}

Next we form matrix whose rows correspond to a product of two primes,
one dividing $3$ and one dividing $5$:
\begin{verbatim}
   ? m = matrix(2,2);       
   ? m[1,] = i[1,];  
   ? m[1,2] = 1;
   ? m[2,] = j[1,];
\end{verbatim}
Note that we set {\tt m[1,2] = 1}, so the exponent is 1
instead of $3$.
We apply the CRT to obtain a lift in terms
of the basis for $\O_K$. 
\begin{verbatim}
   ? ?idealchinese
   idealchinese(nf,x,y): x being a prime ideal factorization and y 
   a vector of elements, gives an element b such that 
   v_p(b-y_p)>=v_p(x) for all prime ideals p dividing x, 
   and v_p(b)>=0 for all other p.
   ? idealchinese(k, m, [x,1])
   [0, 0, -1]~
   ? nfbasis(f)
   [1, x, x^2]
\end{verbatim}
Thus PARI finds the lift $-(\sqrt[3]{2})^2$, and we finish by
verifying that this lift is correct.  I couldn't figure out how to
test for ideal membership in PARI, so here we just check that the
prime ideal plus the element is not the unit ideal, which since the
ideal is prime, implies membership.
\begin{verbatim}
   ? idealadd(k, i[1,1], -x^2 - x)
   [3 1 2]
   [0 1 0]
   [0 0 1]
   ? idealadd(k, j[1,1], -x^2-1)
   [5 2 1]
   [0 1 0]
   [0 0 1]
\end{verbatim}



%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "ant"
%%% End: 
